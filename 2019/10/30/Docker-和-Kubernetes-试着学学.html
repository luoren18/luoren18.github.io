<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker å’Œ Kubernetes  è¯•ç€å­¦å­¦ - RENåšå®¢</title>
    <meta name="author"  content="REN">
    <meta name="description" content="Docker å’Œ Kubernetes  è¯•ç€å­¦å­¦">
    <meta name="keywords"  content="other">
    <!-- Open Graph -->
    <meta property="og:title" content="Docker å’Œ Kubernetes  è¯•ç€å­¦å­¦ - RENåšå®¢">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://localhost:4000/2019/10/30/Docker-%E5%92%8C-Kubernetes-%E8%AF%95%E7%9D%80%E5%AD%A6%E5%AD%A6.html">
    <meta property="og:description" content="ä¸ªäººåšå®¢,RENåšå®¢,JAVA,PYTHON,JEKYLL,JAVAç¨‹åºå‘˜,JAVAç¨‹åºçŒ¿,åå°å¼€å‘ã€‚">
    <meta property="og:site_name" content="RENåšå®¢">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
	
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

	
    <!--
Author: Ray-Eldath
-->
<style>
    .markdown-body .anchor{
        float: left;
        margin-top: -8px;
        margin-left: -20px;
        padding-right: 4px;
        line-height: 1;
        opacity: 0;
    }
    
    .markdown-body .anchor .anchor-icon{
        font-size: 15px
    }
</style>
<script>
    $(document).ready(function() {
        let nodes = document.querySelector(".markdown-body").querySelectorAll("h1,h2,h3")
        for(let node of nodes) {
            var anchor = document.createElement("a")
            var anchorIcon = document.createElement("i")
            anchorIcon.setAttribute("class", "fa fa-anchor fa-lg anchor-icon")
            anchorIcon.setAttribute("aria-hidden", true)
            anchor.setAttribute("class", "anchor")
            anchor.setAttribute("href", "#" + node.getAttribute("id"))
            
            anchor.onmouseover = function() {
                this.style.opacity = "0.4"
            }
            
            anchor.onmouseout = function() {
                this.style.opacity = "0"
            }
            
            anchor.appendChild(anchorIcon)
            node.appendChild(anchor)
        }
    })
</script>
</head>


<body>
  <!--[if lt IE 10]>
<div class="alert-danger" role="alert">ä½ çš„æµè§ˆå™¨å®åœ¨å¤ªå¤ªå¤ªæ—§äº†ï¼Œæ”¾å­¦åˆ«èµ°ï¼Œå‡çº§å®Œæµè§ˆå™¨å†è¯´ï¼<a target="_blank" class="alert-link" href="http://browsehappy.com">ç«‹å³å‡çº§</a></div>
<![endif]-->
  <input id="nm-switch" type="hidden" value="true"> <header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
            <li><a href="/rss.xml" target="_blank">RSS</a></li>
            <li><a href="https://wangchujiang.com/linux-command/" target="_blank">COMMAND LINUX</a></li>
        </ul>
    </nav>
</header>


  <header
    class="g-banner post-header post-pattern-overlappingCircles bgcolor-default post-no-cover"
    data-theme="default">
    <div class="post-wrapper">
      <div class="post-tags">
        
        
        <a href=/tags.html#other class="post-tag">other</a>
        
        
      </div>
      <h1>Docker å’Œ Kubernetes  è¯•ç€å­¦å­¦</h1>
      <div class="post-meta">
        <span class="post-meta-item"><i
            class="iconfont icon-author"></i>luoren</span>
        <time class="post-meta-item" datetime="19-10-30"><i
            class="iconfont icon-date"></i>30 Oct 2019</time>
      </div>
    </div>
    
  </header>

  <div class="post-content visible">
    
    <h2 class="post-subtitle">Docker å’Œ Kubernetes</h2>
    

    <article class="markdown-body">
      <h2 id="å¿«é€Ÿéƒ¨ç½²ä¸€ä¸ªç®€å•çš„docker-åº”ç”¨">å¿«é€Ÿéƒ¨ç½²ä¸€ä¸ªç®€å•çš„docker åº”ç”¨</h2>

<p>1.åˆ›å»ºä¸€ä¸ªç®€å•çš„htmlé¡µé¢</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Title<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Welcome to Docker!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>2.åˆ›å»ºä¸€ä¸ªDockerfile</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> nginx #ä½¿ç”¨nginxä½œä¸ºåŸºç¡€é•œåƒ</span>
<span class="k">COPY</span><span class="s"> html/* /usr/share/nginx/html #å°†å½“å‰html æ–‡ä»¶å¤¹ä¸‹é¢çš„å†…å®¹å¤åˆ¶åˆ°/usr/share/nginx/html</span>
</code></pre></div></div>

<p>3.ä½¿ç”¨å¦‚ä¸‹çš„ç›®å½•ç»“æ„</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker
	|--html
		|--index.html
	|--Dockerfile
</code></pre></div></div>

<p>4.æ„å»ºé•œåƒå¹¶è¿è¡Œ</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> docker-demo:0.1 <span class="nb">.</span> <span class="o">&amp;&amp;</span> docker run <span class="nt">-p</span> 8080:80 <span class="nt">--name</span> test-docker docker-demo:0.1 
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
docker-demo         0.1                 6d438fc13c32        6 minutes ago       126MB
nginx               latest              540a289bab6c        6 days ago          126MB
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
afb4ba793a81        6d438fc13c32        "nginx -g 'daemon ofâ€¦"   5 minutes ago       Up 5 minutes        0.0.0.0:8080-&gt;80/tcp   cocky_lichterman
</code></pre></div></div>

<p>ä½¿ç”¨<code class="highlighter-rouge">docker images</code> å°±å¯çœ‹åˆ°æˆ‘ä»¬æ„å»ºå¥½çš„é•œåƒï¼Œä½¿ç”¨<code class="highlighter-rouge">docker ps </code>å°±å¯ä»¥çœ‹åˆ°å®¹å™¨å·²ç»åœ¨è¿è¡Œ</p>

<p>ä½¿ç”¨æµè§ˆå™¨è®¿é—®<code class="highlighter-rouge">localhost:8080</code> å°±å¯ä»¥çœ‹åˆ° <code class="highlighter-rouge">Welcome to Docker!</code>  çš„æ¬¢è¿æç¤ºã€‚</p>

<p><img src="http://noteimg.luoren.top/markdown_img/20191029110546.png" style="zoom:50%;" /></p>

<h2 id="kubernetes-å®‰è£…">Kubernetes å®‰è£…</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew <span class="nb">install </span>kubectl     <span class="c"># Kubernetes çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯ kubctl</span>
<span class="nv">$ </span>brew cask <span class="nb">install </span>minikube <span class="c"># æœ¬åœ°å•èŠ‚ç‚¹çš„Kubernetes ç¯å¢ƒ</span>
</code></pre></div></div>

<p><a href="https://www.virtualbox.org/">å®‰è£…VirtualBox</a>,ä½œä¸ºè™šæ‹Ÿå¼•æ“</p>

<h3 id="ä½¿ç”¨minikube-å®‰è£…-kubernetes">ä½¿ç”¨minikube å®‰è£… kubernetes</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>minikube start --registry-mirror=https://registry.docker-cn.com

ğŸ˜„  minikube v1.2.0 on linux (amd64)
âš ï¸  Please don't run minikube as root or with 'sudo' privileges. It isn't necessary.
âœ…  using image repository registry.cn-hangzhou.aliyuncs.com/google_containers
ğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=2048MB, Disk=20000MB) ...
ğŸ³  Configuring environment for Kubernetes v1.15.0 on Docker 18.09.6
ğŸšœ  Pulling images ...
ğŸš€  Launching Kubernetes ... 
âŒ›  Verifying: apiserver proxy etcd scheduler controller dns
ğŸ„  Done! kubectl is now configured to use "minikube"
</code></pre></div></div>

<p>æŸ¥çœ‹å½“å‰çš„ Kubernetes ç¯å¢ƒ</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl config current-context
minikube
</code></pre></div></div>

<p>æŸ¥çœ‹minikube èŠ‚ç‚¹</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get nodes
NAME       STATUS   ROLES    AGE     VERSION
minikube   Ready    master   4m20s   v1.15.0
</code></pre></div></div>

<h2 id="åœ¨minikube-ä¸Šéƒ¨ç½²ä¸€ä¸ªå•å®ä¾‹æœåŠ¡">åœ¨minikube ä¸Šéƒ¨ç½²ä¸€ä¸ªå•å®ä¾‹æœåŠ¡</h2>

<p>Kubernetes ä¸­éƒ¨ç½²çš„æœ€å°å•ä½æ˜¯podã€‚ä¸€ä¸ªpodå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªdocker å®¹å™¨ã€‚æ·¡å‡ºäº†æœ‰ç´§å¯†è€¦åˆçš„æƒ…å†µä¸‹ï¼Œé€šå¸¸ä¸€ä¸ªpodä¸­åªæœ‰ä¸€ä¸ªå®¹å™¨ï¼Œè¿™æ ·æ–¹ä¾¿ä¸åŒå¯ŒåŒºå„è‡ªç‹¬è‡ªçš„æ‰©å±•ã€‚</p>

<p><img src="http://noteimg.luoren.top/markdown_img/20191029151720.png" alt="" /></p>

<p>Podè¿è¡Œåœ¨Node ä¹‹ä¸Šã€‚Nodeæ˜¯kubernetesä¸­çš„ä¸€ä¸ªå·¥ä½œæœºå™¨ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºæˆ–è€…ç‰©ç†æœºã€‚æ¯ä¸ªNodeå‘—Masterç®¡ç†ã€‚ä¸€ä¸ªèŠ‚ç‚¹èƒ½æœ‰å¤šä¸ªPodï¼ŒåŒæ—¶Kubernetes master åœ¨é›†ç¾¤ä¹‹ä¸Šè‡ªåŠ¨è°ƒåº¦Pod.</p>

<p><img src="http://noteimg.luoren.top/markdown_img/20191029152341.png" style="zoom:80%;" /></p>

<p>åˆ‡æ¢åˆ°minikube çš„dockerè¿è¡Œç¯å¢ƒ</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>minikube docker-env<span class="k">)</span>
</code></pre></div></div>

<p>æ­¤æ—¶ä½¿ç”¨<code class="highlighter-rouge">docker images</code> å°±ä¸ä¼šçœ‹åˆ°å¤–éƒ¨æ¡Œé¢ç¯å¢ƒdocker çš„image äº†ï¼Œåˆ—å‡ºæ¥çš„æ˜¯minikube å†…éƒ¨çš„docker imageã€‚</p>

<p>æ„å»ºé•œåƒ</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> k8s-demo:0.1 <span class="nb">.</span> 
</code></pre></div></div>

<p>ç„¶ååˆ›å»ºä¸€ä¸ªpod.yml çš„å®šä¹‰æ–‡ä»¶:</p>

<p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå«k8s-demo çš„pod ï¼Œä½¿ç”¨ä¸Šé¢æ„å»ºçš„ k8s-demo:0.1 é•œåƒã€‚åŒæ—¶æ”¾å¼€å®¹å™¨çš„80 ç«¯å£ã€‚</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">k8s-demo</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">k8s-demo</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">k8s-demo</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">k8s-demo:0.1</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre></div></div>

<p>åˆ›å»ºä¸€ä¸ªpod:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> pod.yml 
pod/k8s-demo created
</code></pre></div></div>

<p>å› ä¸ºpod è¿è¡Œåœ¨nodeä¸­ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºè¿è¡Œåœ¨å†…ç½‘ä¸­ï¼Œæ— æ³•ç›´æ¥ä»å¤–éƒ¨ç›´æ¥è®¿é—®åˆ°ï¼Œæ‰€ä»¥éœ€è¦æŠŠæœåŠ¡æš´éœ²å‡ºæ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªService,Service çš„ä½œç”¨æœ‰ç‚¹åƒå»ºç«‹äº†ä¸€ä¸ªåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼Œè´Ÿè´£æŠŠè¯·æ±‚åˆ†å‘ç»™åé¢çš„ podã€‚</p>

<p>åˆ›å»ºä¸€ä¸ªserviceçš„å®šä¹‰æ–‡ä»¶ svc.yml</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">k8s-demo-svc</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">k8s-demo</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="s">80</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="s">30050</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">k8s-demo</span>
</code></pre></div></div>

<p>åˆ›å»ºè¿™ä¸ªservice</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> svc.yml 
service/k8s-demo-svc created
</code></pre></div></div>

<p><img src="http://noteimg.luoren.top/markdown_img/20191029155153.png" style="zoom:67%;" /></p>

<p>ä½¿ç”¨ <code class="highlighter-rouge">minikube service list</code> å¯ä»¥åˆ—å‡ºæ‰€ä»¥service  å¯ä»¥çœ‹å‡ºk8s-demo-svc æš´éœ²å‡ºæ¥çš„url,è®¿é—®è¯¥urlï¼Œå°±èƒ½çœ‹åˆ°æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ç½‘é¡µäº†ã€‚</p>

<h2 id="æ¨ªå‘æ‹“å±•æ»šåŠ¨æ›´æ–°ç‰ˆæœ¬å›æ»š">æ¨ªå‘æ‹“å±•ã€æ»šåŠ¨æ›´æ–°ã€ç‰ˆæœ¬å›æ»š</h2>

<p>åœ¨æ­£å¼ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®©ä¸€ä¸ªæœåŠ¡ä¸å—å•ä¸ªèŠ‚ç‚¹æ•…éšœçš„å½±å“ï¼Œå¹¶ä¸”è¿˜éœ€è¦æ ¹æ®è´Ÿè½½å˜åŒ–åŠ¨æ€è°ƒæ•´èŠ‚ç‚¹çš„æ•°é‡ï¼Œæ‰€ä»¥ä¸èƒ½é€ä¸ªç®¡ç†Pod ã€‚Kubernetesçš„ç”¨æˆ·é€šå¸¸æ˜¯ç”¨<strong><em>Deployment</em></strong> æ¥ç®¡ç†æœåŠ¡çš„ã€‚ä¸€ä¸ªdeployment å¯ä»¥åˆ›å»ºæŒ‡å®šæ•°é‡çš„podéƒ¨ç½²åˆ°å„ä¸ªnodeä¸Šï¼Œå¹¶å¯å®Œæˆæ›´æ–°ã€å›æ»šç­‰æ“ä½œã€‚</p>

<p>åˆ›å»ºä¸€ä¸ªå®šä¹‰æ–‡ä»¶ deployment.yml</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">k8s-demo-deployment</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="s">10</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">k8s-demo</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">k8s-demo-pod</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">k8s-demo:0.1</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">replicas: 10</code> æŒ‡å®šäº†è¿™ä¸ªdeployment è¦æœ‰10ä¸ªpodã€‚</p>

<p>åˆ›å»ºè¿™ä¸ªdeployment ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> deployment.yml 
deployment.extensions/k8s-demo-deployment created
</code></pre></div></div>

<p>æŸ¥çœ‹è¿™ä¸ªdeployment çš„å‰¯æœ¬é›†</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get rs
NAME                             DESIRED   CURRENT   READY   AGE
k8s-demo-deployment-696fc9dc4b   10        10        10      44s
</code></pre></div></div>

<p>ä¿®æ”¹html æ–‡ä»¶çš„å†…å®¹ï¼Œé‡æ–°æ„å»ºé•œåƒï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Welcome to Docker!<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Welcome to Docker!<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;h3&gt;</span>Welcome to Docker!<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;h4&gt;</span>Welcome to Docker!<span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;h5&gt;</span>Welcome to Docker!<span class="nt">&lt;/h5&gt;</span>
    <span class="nt">&lt;h6&gt;</span>Welcome to Docker!<span class="nt">&lt;/h6&gt;</span>
  	<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"http://noteimg.luoren.top/markdown_img/20191029152341.png"</span> <span class="na">style=</span><span class="s">"zoom:80%;"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">docker build -t k8s-demo:0.2</code></p>

<p>ç„¶åæ›´æ–°deployment.yml:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">k8s-demo-deployment</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="c1"># å‰¯æœ¬ä¸ªæ•°</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="s">10</span>
  <span class="c1"># æœ€å°å°±ç»ªç§’</span>
  <span class="na">minReadySeconds</span><span class="pi">:</span> <span class="s">10</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="c1"># æ»šåŠ¨æ›´æ–°</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">RollingUpdate</span>
    <span class="na">rollingUpdate</span><span class="pi">:</span>
      <span class="c1"># æœ€å¤§ä¸å¯ç”¨</span>
      <span class="na">maxUnavailable</span><span class="pi">:</span> <span class="s">1</span>
      <span class="c1"># æœ€å¤§å¤šä½™çš„Pod</span>
      <span class="na">maxSurge</span><span class="pi">:</span> <span class="s">1</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">k8s-demo</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">k8s-demo-pod</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">k8s-demo:0.2</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre></div></div>

<p>ç‰ˆæœ¬æ›´æ–°</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> deployment.yml <span class="nt">--record</span><span class="o">=</span><span class="nb">true
</span>deployment.extensions/k8s-demo-deployment configured
</code></pre></div></div>

<p>è¿™é‡Œçš„ <code class="highlighter-rouge">--record=true</code> è®© Kubernetes æŠŠè¿™è¡Œå‘½ä»¤è®°åˆ°å‘å¸ƒå†å²ä¸­å¤‡æŸ¥ã€‚</p>

<p>ç‰ˆæœ¬å›æ»š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout undo deployment k8s-demo-deployment <span class="nt">--to-revision</span><span class="o">=</span>1
</code></pre></div></div>

<p>æŸ¥çœ‹å‘å¸ƒçš„å®æ—¶çŠ¶æ€</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout status deployment k8s-demo-deployment
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 6 out of 10 new replicas have been updated...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 6 out of 10 new replicas have been updated...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 6 out of 10 new replicas have been updated...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 8 out of 10 new replicas have been updated...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 8 out of 10 new replicas have been updated...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 8 out of 10 new replicas have been updated...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 8 out of 10 new replicas have been updated...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 8 out of 10 new replicas have been updated...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 1 old replicas are pending termination...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 1 old replicas are pending termination...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 1 old replicas are pending termination...
Waiting <span class="k">for </span>deployment <span class="s2">"k8s-demo-deployment"</span> rollout to finish: 1 old replicas are pending termination...
deployment <span class="s2">"k8s-demo-deployment"</span> successfully rolled out
</code></pre></div></div>

<h2 id="kubernetes-ä¸­poddeploymentreplicasetservice-ä¹‹é—´å…³ç³»åˆ†æ">kubernetes ä¸­ï¼ŒPodã€Deploymentã€ReplicaSetã€Service ä¹‹é—´å…³ç³»åˆ†æ</h2>

<p>é¦–å…ˆä¸€ç‚¹ï¼ŒPod æ˜¯kubernetes çš„æœ€å°è°ƒåº¦å•ä½ã€‚</p>

<p><code class="highlighter-rouge">kubectl describe pod pod-name</code>,å¯ä»¥ç”¨æ¥æŸ¥çœ‹pod çš„è¯¦æƒ…</p>

<p>é€‰å–æˆ‘ä»¬æœ¬æœºä¸€ä¸ªpod ï¼ŒæŸ¥çœ‹ä»–çš„è¯¦æƒ…ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå…³é”®ä¿¡æ¯æ˜¯<code class="highlighter-rouge">Controlled By:  ReplicaSet/k8s-demo-deployment-854d54b68</code>,ä¹Ÿå°±æ˜¯è¯´è¯¥podæ˜¯å—æ§äº ä¸€ä¸ªåå­—ä¸º k8s-demo-deployment-854d54b68 çš„ <strong><em>ReplicaSet</em></strong>ã€‚æ‰€ä»¥å¯ä»¥å¾—å‡ºç»“è®ºæ˜¯ ReplicaSet æ˜¯ æ˜¯æ¯”Pod é«˜çº§åˆ«çš„ç”¨æ¥ç®¡ç† Pod çš„ç»„ä»¶ã€‚</p>

<p>åŒæ ·çš„ï¼Œå¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">kubectl describe rs rs-name</code> æŸ¥çœ‹ replicaSet çš„è¯¦æƒ…</p>

<p>åŒæ ·çš„å¯ä»¥çœ‹è§ä¸€æ¡ï¼š<code class="highlighter-rouge">Controlled By:  Deployment/k8s-demo-deployment</code>ï¼Œè¯´æ˜ ReplicaSet æ˜¯å—é«˜ä¸€çº§åˆ«çš„Deployment ç®¡ç†çš„ã€‚</p>

<p>åŒæ ·çš„æ–¹æ³•äº§çœ‹ deployment çš„çŠ¶æ€ï¼Œå‘ç°åœ¨deployment çº§åˆ«ä¸Šï¼Œä¸åœ¨å—å…¶ä»–ç»„ä»¶çš„æ§åˆ¶ã€‚</p>

<p><strong><em>å„ä¸ªç»„ä»¶åœ¨å¹²ä»€ä¹ˆï¼Ÿ</em></strong></p>

<p>åœ¨è¯¦æƒ…ä¿¡æ¯ä¸­æœ‰å…³<strong>Events</strong>çš„ä¿¡æ¯</p>

<p>pod: å¯ä»¥çœ‹å‡ºpodä¸­æ˜¯å¯¹å®¹å™¨çš„æ“ä½œã€‚é•œåƒçš„æ‹‰å–ï¼Œå®¹å™¨çš„åˆ›å»ºå’Œå¯åŠ¨ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Events:
  Type    Reason     Age   From               Message
  <span class="nt">----</span>    <span class="nt">------</span>     <span class="nt">----</span>  <span class="nt">----</span>               <span class="nt">-------</span>
  Normal  Scheduled  12m   default-scheduler  Successfully assigned default/k8s-demo-deployment-854d54b68-bzn48 to minikube
  Normal  Pulled     12m   kubelet, minikube  Container image <span class="s2">"k8s-demo:0.4"</span> already present on machine
  Normal  Created    12m   kubelet, minikube  Created container k8s-demo-pod
  Normal  Started    12m   kubelet, minikube  Started container k8s-demo-pod
</code></pre></div></div>

<p>ReplicaSet:éƒ½æ˜¯å¯¹ Pod çš„æ“ä½œã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Events:
  Type    Reason            Age   From                   Message
  <span class="nt">----</span>    <span class="nt">------</span>            <span class="nt">----</span>  <span class="nt">----</span>                   <span class="nt">-------</span>
  Normal  SuccessfulCreate  30m   replicaset-controller  Created pod: k8s-demo-deployment-854d54b68-bzn48
  Normal  SuccessfulCreate  30m   replicaset-controller  Created pod: k8s-demo-deployment-854d54b68-8bp6k
  Normal  SuccessfulCreate  29m   replicaset-controller  Created pod: k8s-demo-deployment-854d54b68-8kr7p
  Normal  SuccessfulCreate  29m   replicaset-controller  Created pod: k8s-demo-deployment-854d54b68-jtdjc
  Normal  SuccessfulCreate  29m   replicaset-controller  Created pod: k8s-demo-deployment-854d54b68-bf2zg
  Normal  SuccessfulCreate  29m   replicaset-controller  Created pod: k8s-demo-deployment-854d54b68-nshfj
  Normal  SuccessfulCreate  29m   replicaset-controller  Created pod: k8s-demo-deployment-854d54b68-q8fds
  Normal  SuccessfulCreate  29m   replicaset-controller  Created pod: k8s-demo-deployment-854d54b68-nr6gp
  Normal  SuccessfulCreate  29m   replicaset-controller  Created pod: k8s-demo-deployment-854d54b68-7m5x5
  Normal  SuccessfulCreate  29m   replicaset-controller  <span class="o">(</span>combined from similar events<span class="o">)</span>: Created pod: k8s-demo-deployment-854d54b68-bjs62
</code></pre></div></div>

<p>Deployment: åˆ›å»ºæœåŠ¡ï¼Œæ»šåŠ¨å‡çº§ä¸€ä¸ªæœåŠ¡ï¼Œæˆ–è€…æ˜¯æ“ä½œ RS ä¼¸ç¼© Pod é›†ç¾¤</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Events:
  Type    Reason             Age                 From                   Message
  <span class="nt">----</span>    <span class="nt">------</span>             <span class="nt">----</span>                <span class="nt">----</span>                   <span class="nt">-------</span>
  Normal  ScalingReplicaSet  42m                 deployment-controller  Scaled up replica <span class="nb">set </span>k8s-demo-deployment-5554dd9f7c to 1
  Normal  ScalingReplicaSet  42m                 deployment-controller  Scaled down replica <span class="nb">set </span>k8s-demo-deployment-696fc9dc4b to 9
  Normal  ScalingReplicaSet  42m                 deployment-controller  Scaled up replica <span class="nb">set </span>k8s-demo-deployment-5554dd9f7c to 2
  Normal  ScalingReplicaSet  42m                 deployment-controller  Scaled down replica <span class="nb">set </span>k8s-demo-deployment-696fc9dc4b to 7
  Normal  ScalingReplicaSet  42m                 deployment-controller  Scaled up replica <span class="nb">set </span>k8s-demo-deployment-5554dd9f7c to 4
  Normal  ScalingReplicaSet  42m                 deployment-controller  Scaled down replica <span class="nb">set </span>k8s-demo-deployment-696fc9dc4b to 5
  Normal  ScalingReplicaSet  42m                 deployment-controller  Scaled up replica <span class="nb">set </span>k8s-demo-deployment-5554dd9f7c to 6
  Normal  ScalingReplicaSet  42m                 deployment-controller  Scaled down replica <span class="nb">set </span>k8s-demo-deployment-696fc9dc4b to 3
  Normal  ScalingReplicaSet  42m                 deployment-controller  Scaled up replica <span class="nb">set </span>k8s-demo-deployment-5554dd9f7c to 8
  Normal  ScalingReplicaSet  32m <span class="o">(</span>x17 over 42m<span class="o">)</span>  deployment-controller  <span class="o">(</span>combined from similar events<span class="o">)</span>: Scaled up replica <span class="nb">set </span>k8s-demo-deployment-854d54b68 to 1
  Normal  ScalingReplicaSet  32m                 deployment-controller  Scaled down replica <span class="nb">set </span>k8s-demo-deployment-5554dd9f7c to 9
</code></pre></div></div>

<p><strong>ç»“è®ºï¼šdeployæ§åˆ¶RSï¼ŒRSæ§åˆ¶Podï¼Œè¿™ä¸€æ•´å¥—ï¼Œå‘å¤–æä¾›ç¨³å®šå¯é çš„Service</strong></p>

<p><img src="http://noteimg.luoren.top/markdown_img/20191030113207.png" alt="" /></p>

<h2 id="end"><strong>End</strong></h2>

    </article>

    
    <div class="social-share-wrapper">
      <div class="social-share"></div>
    </div>
    
  </div>

  <section class="author-detail">
    <section class="post-footer-item author-card">
      <div class="avatar">
        <!-- <img src="http://noteimg.luoren.top/markdown_img/20190428084026.png" alt=""> -->
        <img src="http://noteimg.luoren.top/markdown_img/20190428084026.png" alt="">
      </div>
      <div class="author-name" rel="author">REN</div>
      <div class="bio">
        <p>ç å†œï¼ŒJAVAç¨‹åºå‘˜ï¼Œçˆ±ä¸‹å¨ï¼Œå‡è£…çƒ­çˆ±æŠ€æœ¯&ç”Ÿæ´»ç¨å¾®è¿‡è¿‡ä¹Ÿèƒ½æ´»ä¸‹å»ï¼Œå“ªæœ‰é‚£ä¹ˆå¤šè¦æ±‚</p>
      </div>
      
      <ul class="sns-links">
        
        <li>
          <a href="//weibo.com/lawren18" target="_blank">
            <i class="iconfont icon-weibo"></i>
          </a>
        </li>
        
        <li>
          <a href="mailto:luoren96@gmail.com" target="_blank">
            <i class="iconfont icon-email"></i>
          </a>
        </li>
        
        <li>
          <a href="//twitter.com/kaiorren" target="_blank">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
        
        <li>
          <a href="//github.com/luoren18" target="_blank">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
        
      </ul>
      
    </section>
    <section class="post-footer-item read-next">
      

      
      <div class="read-next-item">
        <a href="/2019/10/24/%E9%9C%9C%E9%99%8D.html" class="read-next-link"></a>
        <section>
          <span>éœœé™</span>
          <p></p>
        </section>
        
      </div>
      
    </section>
    
  </section>

  <footer class="g-footer">
  <section>RENåšå®¢ Â©
  
  
  2019
  </section>
  <section>Powered by <a href="//jekyllrb.com">Jekyll</a> | <a href="https://github.com/kaeyleo/jekyll-theme-H2O">Theme H2O</a></section>
</footer>


  <script src="/assets/js/social-share.min.js"></script>
  <script>
      socialShare('.social-share', {
        sites: [
          
            'wechat'
            ,
            
          
            'weibo'
            ,
            
          
            'douban'
            ,
            
          
            'twitter'
            
          
        ],
        wechatQrcodeTitle: "åˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ",
        wechatQrcodeHelper: '<p>æ‰«ç åç‚¹å‡»å³ä¸Šè§’</p><p>å°†æœ¬æ–‡åˆ†äº«è‡³æœ‹å‹åœˆ</p>'
      });
    </script>

  <!--  -->
  
  <script src="/assets/js/prism.js"></script>
  <script src="/assets/js/index.min.js"></script>
</body>

</html>